<!DOCTYPE html>
<html>
<head>
	<title>test cross-domian</title>
	<script src="./js/jquery-1.8.1.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/jasmine.css">
	<script src="./js/jasmine.js"></script>
	<script src="./js/jasmine-html.js"></script>
	<script src="./js/boot.js"></script>
</head>
<body>
  <!-- <button id="btn">测试跨域</button>
	<img src="http://localhost:3000" alt="#">  -->
  <script type="text/javascript">
    /*$("#btn").click(() => {
    	$.get("http://localhost:3000/ajax",(data,status) => {
    		console.log(data);
    	})
    });*/

    //每一个测试用例的超时时间
    jasmine.DEFAULT_TIMEOUT_INTERVAL = 1000;

    //请求的接口
    let base = "http://localhost:3000";

    //测试模块
    describe("ajax跨域",() => {
    	//测试用例
    	it("jsonp请求",done => {
        //服务器返回结果
    		let result;
    		$.ajax({
    			url:base + '/ajax/getJson',
    			dataType:"jsonp",
    			cache:true,
    			type:"post",
    			success:json => {
    				result = json;
    			}
    		});
        //异步请求，使用setTimeout校验
        setTimeout(() => {
        	expect(result).toEqual(
        		{"name":"yilule"}
        	);
          //校验完成，通知jasmine 
        	done();
        },100);
    	});

      //测试用例
    	it("get请求",done => {
        //服务器返回结果
    		let result;
    		$.getJSON(base+'/ajax/getJson').then(jsonObj => {
    			result = jsonObj;
    		})
        //异步请求，使用setTimeout校验
        setTimeout(() => {
        	expect(result).toEqual(
        		{"name":"yilule"}
        	);
          //校验完成，通知jasmine 
        	done();
        },100);
    	});

    	//测试用例
    	it("post请求",done => {
        //服务器返回结果
    		let result;
    		$.ajax({
    			url:base + '/ajax/postJson',
    			type:'post',
    			contentType:'application/json;charset=utf-8',
    			data:JSON.stringify({name:'yilulePost'}),
    			success:json => {
    				result = json;
    			}
    		})
        //异步请求，使用setTimeout校验
        setTimeout(() => {
        	expect(result).toEqual(
        		{"name":"yilulePost"}
        	);
          //校验完成，通知jasmine 
        	done();
        },100);
    	});

      //getCookie请求
      it("getCookie请求",done => {
      	let result;
      	$.ajax({
      		url:base + '/ajax/getCookie',
      		type:'get',
      		xhrFields:{
      			withCredentials:true
      		},
      		success:json => {
      			result = json;
      		}
      	});

      	setTimeout(() => {
      		expect(result).toEqual(
            {"user":"yiluleCookie"}
      		);
      		done();
      	},100);
      });  	
    });  	

  </script>
</body>
</html>